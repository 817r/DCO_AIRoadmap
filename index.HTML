<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Dragon Company AI Reforger – Roadmap</title>
    <link rel="stylesheet" href="styles.css" />
</head>
<body>
    <header class="page-header">
        <h1>Dragon Company AI Reforger – Development Roadmap</h1>
        <p class="subtitle">
            Roadmap untuk developers & community. Lihat progress terbaru!
        </p>
    </header>

    <!-- Overall Progress -->
    <section class="overall-progress-section">
        <h2>Overall Progress</h2>
        <div class="overall-progress-wrapper">
            <div id="overallProgressBar" class="overall-progress-bar">
                <div id="overallProgressFill" class="overall-progress-fill"></div>
            </div>
            <span id="overallProgressLabel" class="overall-progress-label">0%</span>
        </div>
        <p class="help-text">Rata-rata progress semua fitur.</p>
    </section>

    <!-- Project Overview -->
    <section class="project-overview-section">
        <h2>Project Overview & Release Roadmap</h2>
        <p class="help-text">Progress per kategori dari fitur di bawah.</p>
        <table class="overview-table">
            <thead>
                <tr>
                    <th>Area</th>
                    <th>Scope</th>
                    <th>Progress</th>
                    <th>ETA</th>
                </tr>
            </thead>
            <tbody>
                <tr data-overview-category="Global">
                    <td>Global Systems</td>
                    <td>BI fixes, AI core, global combat context.</td>
                    <td>
                        <div class="overview-progress-bar">
                            <div id="overview-global-bar" class="overview-progress-fill"></div>
                        </div>
                        <span id="overview-global-label" class="overview-progress-label">0%</span>
                    </td>
                    <td>TBD</td>
                </tr>
                <!-- Tambahkan row lain seperti Soldier, Vehicle, Artillery mirip asli -->
            </tbody>
        </table>
    </section>

    <main class="layout">
        <section class="table-section">
            <div class="table-header-row">
                <h2>Feature Roadmap</h2>
                <div class="controls">
                    <label for="categoryFilter">Filter by category:</label>
                    <select id="categoryFilter">
                        <option value="all">All</option>
                        <option value="Global">Global</option>
                        <option value="Soldier">Soldier</option>
                        <option value="Vehicle">Vehicle</option>
                        <option value="Artillery">Artillery</option>
                    </select>
                </div>
            </div>

            <table id="roadmapTable">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Feature</th>
                        <th>Version</th>
                        <th>Priority</th>
                        <th>Progress</th>
                    </tr>
                </thead>
                <tbody id="roadmapBody"></tbody>
            </table>
            <p class="help-text">Hover untuk detail fitur.</p>
        </section>

        <aside class="hint-section">
            <h2>Feature Details</h2>
            <div id="hintBox" class="hint-box">
                <p class="hint-placeholder">Hover over a feature row to see its full description here.</p>
            </div>
            <div class="legend">
                <h3>Legend</h3>
                <ul>
                    <li><span class="legend-color legend-low"></span>0–25%: Planned</li>
                    <li><span class="legend-color legend-mid"></span>25–75%: In Progress</li>
                    <li><span class="legend-color legend-high"></span>75–100%: Nearly Done / Done</li>
                </ul>
            </div>
        </aside>
    </main>

    <script>
        fetch("roadmap.json")
            .then(r => r.json())
            .then(data => renderRoadmap(data.features));

        function renderRoadmap(features) {
            const body = document.getElementById("roadmapBody");
            body.innerHTML = "";
            features.forEach(f => {
                const row = document.createElement("tr");
                row.setAttribute("data-category", f.category);
                row.setAttribute("data-description", f.description);
                row.innerHTML = `
                    <td>${f.category}</td>
                    <td>${f.name}</td>
                    <td>${f.version}</td>
                    <td>${f.priority}</td>
                    <td class="progress-cell">
                        <div class="progress-bar-static" style="width: ${f.progress}%; background: ${progressToColor(f.progress)};"></div>
                        <span class="progress-label">${f.progress}%</span>
                    </td>
                `;
                body.appendChild(row);
                attachHover(row);
            });
            updateOverallProgress(features);
            updateCategoryOverview(features);
        }

        function progressToColor(value) {
            const hue = (value * 1.2);
            return `hsl(${hue}, 70%, 50%)`;
        }

        function attachHover(row) {
            row.addEventListener("mouseenter", () => {
                const hintBox = document.getElementById("hintBox");
                const feature = row.cells[1].innerText;
                const version = row.cells[2].innerText;
                const priority = row.cells[3].innerText;
                const desc = row.getAttribute("data-description");
                hintBox.innerHTML = `
                    <h3>${feature}</h3>
                    <p><strong>Version:</strong> ${version}</p>
                    <p><strong>Priority:</strong> ${priority}</p>
                    <p>${desc}</p>
                `;
            });
        }

        function updateOverallProgress(features) {
            const total = features.reduce((sum, f) => sum + f.progress, 0);
            const avg = Math.round(total / features.length);
            document.getElementById("overallProgressFill").style.width = `${avg}%`;
            document.getElementById("overallProgressFill").style.backgroundColor = progressToColor(avg);
            document.getElementById("overallProgressLabel").textContent = `${avg}%`;
        }

        function updateCategoryOverview(features) {
            ["Global", "Soldier", "Vehicle", "Artillery"].forEach(cat => {
                const catFeatures = features.filter(f => f.category === cat);
                if (!catFeatures.length) return;
                const total = catFeatures.reduce((sum, f) => sum + f.progress, 0);
                const avg = Math.round(total / catFeatures.length);
                document.getElementById(`overview-${cat.toLowerCase()}-bar`).style.width = `${avg}%`;
                document.getElementById(`overview-${cat.toLowerCase()}-bar`).style.backgroundColor = progressToColor(avg);
                document.getElementById(`overview-${cat.toLowerCase()}-label`).textContent = `${avg}%`;
            });
        }

        document.getElementById("categoryFilter").addEventListener("change", e => {
            const value = e.target.value;
            document.querySelectorAll("#roadmapBody tr").forEach(row => {
                row.style.display = (value === "all" || row.getAttribute("data-category") === value) ? "" : "none";
            });
        });
    </script>
</body>
</html>